"use strict";

navigator.permissions.query({
  name: 'camera'
}).then(permission => {
  console.log("camera state", permission.state);
}).catch(error => {
  console.log('Got error :', error);
});
Webcam.set({
  height: 450,
  width: 800,
  image_format: 'jpeg',
  jpeg_quality: 100
});
Webcam.attach('#my_camera');
let audio = new Audio('../assets/audio/pop.mp3');
let hatCount = document.getElementById("hat-count");
let hatCountList = [1, 5, 10, 15, 20];
let hatCountIndex = 0;
let hatContainer = document.getElementById("hat-type");
let hatIndex = 0;
let hatList;
let overlay = document.getElementById("overlay");
let loadingGif = document.getElementById("loading");
let camera = document.getElementById("my_camera");
let buttonControls = document.getElementById("button-controls");

window.onload = async () => {
  hatCount.innerHTML = hatCountList[hatCountIndex];
  let baseUrl = "/api/list"; // get description and image links

  let hats = await fetch(baseUrl, {
    method: "GET"
  });
  hatList = await hats.json();
  console.log(hatList);
  setHats(hatList);
};

function setHats(hatList) {
  hatContainer.src = hatList[hatIndex].url;
  hatContainer.alt = hatList[hatIndex].description;
}

document.getElementById("hat-type-container").addEventListener("click", () => {
  audio.play();
  hatIndex += 1;

  if (hatIndex > hatList.length - 1) {
    hatIndex = 0;
  }

  hatContainer.src = hatList[hatIndex].url;
  hatContainer.alt = hatList[hatIndex].description;
});
document.getElementById("count-container").addEventListener("click", () => {
  audio.play();
  hatCountIndex += 1;

  if (hatCountIndex > 4) {
    hatCountIndex = 0;
  }

  hatCount.innerHTML = hatCountList[hatCountIndex];
});
document.getElementById("snap").addEventListener('click', () => {
  audio.play();
  overlay.classList.remove("hidden");
  loadingGif.classList.remove("hidden");
  removeAllChildNodes(camera);
  let spinner = document.getElementById('spinner');
  let result = document.getElementById('result');
  Webcam.snap(async function (data_uri) {
    // display results in page  
    var file = dataURLtoFile(data_uri, 'bruh.jpeg');
    console.log(file); // SaveBlobAs(file, "test.jpeg");

    var formData = new FormData();
    let baseUrl = "/api/hat";
    let type = document.getElementById("hat-type").alt;
    baseUrl += `?number=${hatCount.innerHTML}`;
    let method;
    let options = {};
    method = "POST";
    formData.append("file", file);
    options = {
      method,
      headers: {
        type
      },
      body: formData
    };
    console.log("Making fetch");
    console.log(baseUrl);
    console.log(options);
    let resp = await fetch(baseUrl, options);
    let data = await resp.json();
    console.log(data);
    let img = document.createElement("img");
    img.src = data.result.finalBaby;
    camera.appendChild(img); // result.classList.remove("hidden");
    // console.log(document.getElementById("result"));

    loadingGif.classList.add('hidden');
    overlay.classList.add("hidden");
    buttonControls.classList.add("hidden");
    document.getElementById("reset").classList.remove("hidden");
  });
});
document.getElementById("reset").addEventListener("click", () => {
  removeAllChildNodes(camera);
  Webcam.attach('#my_camera');
  buttonControls.classList.remove("hidden");
  document.getElementById("reset").classList.add("hidden");
});

function SaveBlobAs(blob, file_name) {
  if (typeof navigator.msSaveBlob == "function") return navigator.msSaveBlob(blob, file_name);
  var saver = document.createElementNS("http://www.w3.org/1999/xhtml", "a");
  var blobURL = saver.href = URL.createObjectURL(blob),
      body = document.body;
  saver.download = file_name;
  body.appendChild(saver);
  saver.dispatchEvent(new MouseEvent("click"));
  body.removeChild(saver);
  URL.revokeObjectURL(blobURL);
}

function dataURLtoFile(dataurl, filename) {
  var arr = dataurl.split(','),
      mime = arr[0].match(/:(.*?);/)[1],
      bstr = atob(arr[1]),
      n = bstr.length,
      u8arr = new Uint8Array(n);
  console.log(mime);

  while (n--) {
    u8arr[n] = bstr.charCodeAt(n);
  }

  return new File([u8arr], filename, {
    type: mime
  });
} // click event listener


$('body').on('click', function (e) {
  explode(e.pageX, e.pageY);
}); // explosion construction

function explode(x, y) {
  var particles = 15,
      // explosion container and its reference to be able to delete it on animation end
  explosion = $('<div class="explosion"></div>'); // put the explosion container into the body to be able to get it's size

  $('body').append(explosion); // position the container to be centered on click

  explosion.css('left', x - explosion.width() / 2);
  explosion.css('top', y - explosion.height() / 2);

  for (var i = 0; i < particles; i++) {
    // positioning x,y of the particle on the circle (little randomized radius)
    var x = explosion.width() / 2 + rand(80, 150) * Math.cos(2 * Math.PI * i / rand(particles - 10, particles + 10)),
        y = explosion.height() / 2 + rand(80, 150) * Math.sin(2 * Math.PI * i / rand(particles - 10, particles + 10)),
        color = rand(0, 255) + ', ' + rand(0, 255) + ', ' + rand(0, 255),
        // randomize the color rgb
    // particle element creation (could be anything other than div)
    elm = $('<div class="particle" style="' + 'background-color: rgb(' + color + ') ;' + 'top: ' + y + 'px; ' + 'left: ' + x + 'px"></div>');

    if (i == 0) {
      // no need to add the listener on all generated elements
      // css3 animation end detection
      elm.one('webkitAnimationEnd oanimationend msAnimationEnd animationend', function (e) {
        explosion.remove(); // remove this explosion container when animation ended
      });
    }

    explosion.append(elm);
  }
} // get random number between min and max value


function rand(min, max) {
  return Math.floor(Math.random() * (max + 1)) + min;
}

function removeAllChildNodes(parent) {
  while (parent.firstChild) {
    parent.removeChild(parent.firstChild);
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2Fzc2V0cy9qcy9waG90by5qcyJdLCJuYW1lcyI6WyJuYXZpZ2F0b3IiLCJwZXJtaXNzaW9ucyIsInF1ZXJ5IiwibmFtZSIsInRoZW4iLCJwZXJtaXNzaW9uIiwiY29uc29sZSIsImxvZyIsInN0YXRlIiwiY2F0Y2giLCJlcnJvciIsIldlYmNhbSIsInNldCIsImhlaWdodCIsIndpZHRoIiwiaW1hZ2VfZm9ybWF0IiwianBlZ19xdWFsaXR5IiwiYXR0YWNoIiwiYXVkaW8iLCJBdWRpbyIsImhhdENvdW50IiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImhhdENvdW50TGlzdCIsImhhdENvdW50SW5kZXgiLCJoYXRDb250YWluZXIiLCJoYXRJbmRleCIsImhhdExpc3QiLCJvdmVybGF5IiwibG9hZGluZ0dpZiIsImNhbWVyYSIsImJ1dHRvbkNvbnRyb2xzIiwid2luZG93Iiwib25sb2FkIiwiaW5uZXJIVE1MIiwiYmFzZVVybCIsImhhdHMiLCJmZXRjaCIsIm1ldGhvZCIsImpzb24iLCJzZXRIYXRzIiwic3JjIiwidXJsIiwiYWx0IiwiZGVzY3JpcHRpb24iLCJhZGRFdmVudExpc3RlbmVyIiwicGxheSIsImxlbmd0aCIsImNsYXNzTGlzdCIsInJlbW92ZSIsInJlbW92ZUFsbENoaWxkTm9kZXMiLCJzcGlubmVyIiwicmVzdWx0Iiwic25hcCIsImRhdGFfdXJpIiwiZmlsZSIsImRhdGFVUkx0b0ZpbGUiLCJmb3JtRGF0YSIsIkZvcm1EYXRhIiwidHlwZSIsIm9wdGlvbnMiLCJhcHBlbmQiLCJoZWFkZXJzIiwiYm9keSIsInJlc3AiLCJkYXRhIiwiaW1nIiwiY3JlYXRlRWxlbWVudCIsImZpbmFsQmFieSIsImFwcGVuZENoaWxkIiwiYWRkIiwiU2F2ZUJsb2JBcyIsImJsb2IiLCJmaWxlX25hbWUiLCJtc1NhdmVCbG9iIiwic2F2ZXIiLCJjcmVhdGVFbGVtZW50TlMiLCJibG9iVVJMIiwiaHJlZiIsIlVSTCIsImNyZWF0ZU9iamVjdFVSTCIsImRvd25sb2FkIiwiZGlzcGF0Y2hFdmVudCIsIk1vdXNlRXZlbnQiLCJyZW1vdmVDaGlsZCIsInJldm9rZU9iamVjdFVSTCIsImRhdGF1cmwiLCJmaWxlbmFtZSIsImFyciIsInNwbGl0IiwibWltZSIsIm1hdGNoIiwiYnN0ciIsImF0b2IiLCJuIiwidThhcnIiLCJVaW50OEFycmF5IiwiY2hhckNvZGVBdCIsIkZpbGUiLCIkIiwib24iLCJlIiwiZXhwbG9kZSIsInBhZ2VYIiwicGFnZVkiLCJ4IiwieSIsInBhcnRpY2xlcyIsImV4cGxvc2lvbiIsImNzcyIsImkiLCJyYW5kIiwiTWF0aCIsImNvcyIsIlBJIiwic2luIiwiY29sb3IiLCJlbG0iLCJvbmUiLCJtaW4iLCJtYXgiLCJmbG9vciIsInJhbmRvbSIsInBhcmVudCIsImZpcnN0Q2hpbGQiXSwibWFwcGluZ3MiOiI7O0FBQUFBLFNBQVMsQ0FBQ0MsV0FBVixDQUFzQkMsS0FBdEIsQ0FBNEI7QUFBRUMsRUFBQUEsSUFBSSxFQUFFO0FBQVIsQ0FBNUIsRUFDS0MsSUFETCxDQUNXQyxVQUFELElBQWdCO0FBQ2xCQyxFQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWSxjQUFaLEVBQTRCRixVQUFVLENBQUNHLEtBQXZDO0FBQ0gsQ0FITCxFQUdPQyxLQUhQLENBR2NDLEtBQUQsSUFBVztBQUNoQkosRUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVksYUFBWixFQUEyQkcsS0FBM0I7QUFDSCxDQUxMO0FBT0FDLE1BQU0sQ0FBQ0MsR0FBUCxDQUFXO0FBQ1BDLEVBQUFBLE1BQU0sRUFBRSxHQUREO0FBRVBDLEVBQUFBLEtBQUssRUFBRSxHQUZBO0FBR1BDLEVBQUFBLFlBQVksRUFBRSxNQUhQO0FBSVBDLEVBQUFBLFlBQVksRUFBRTtBQUpQLENBQVg7QUFPQUwsTUFBTSxDQUFDTSxNQUFQLENBQWMsWUFBZDtBQUVBLElBQUlDLEtBQUssR0FBRyxJQUFJQyxLQUFKLENBQVUseUJBQVYsQ0FBWjtBQUdBLElBQUlDLFFBQVEsR0FBR0MsUUFBUSxDQUFDQyxj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QzdEO0FBQ3ZCLE9BRkQ7QUFHSDs7QUFDRDJELElBQUFBLFNBQVMsQ0FBQy9DLE1BQVYsQ0FBaUJ3RCxHQUFqQjtBQUNIO0FBQ0osQyxDQUVEOzs7QUFDQSxTQUFTTixJQUFULENBQWNRLEdBQWQsRUFBbUJDLEdBQW5CLEVBQXdCO0FBQ3BCLFNBQU9SLElBQUksQ0FBQ1MsS0FBTCxDQUFXVCxJQUFJLENBQUNVLE1BQUwsTUFBaUJGLEdBQUcsR0FBRyxDQUF2QixDQUFYLElBQXdDRCxHQUEvQztBQUNIOztBQUVELFNBQVNyRSxtQkFBVCxDQUE2QnlFLE1BQTdCLEVBQXFDO0FBQ2pDLFNBQU9BLE1BQU0sQ0FBQ0MsVUFBZCxFQUEwQjtBQUN0QkQsSUFBQUEsTUFBTSxDQUFDdkMsV0FBUCxDQUFtQnVDLE1BQU0sQ0FBQ0MsVUFBMUI7QUFDSDtBQUNKIiwic291cmNlc0NvbnRlbnQiOlsibmF2aWdhdG9yLnBlcm1pc3Npb25zLnF1ZXJ5KHsgbmFtZTogJ2NhbWVyYScgfSlcbiAgICAudGhlbigocGVybWlzc2lvbikgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhcImNhbWVyYSBzdGF0ZVwiLCBwZXJtaXNzaW9uLnN0YXRlKTtcbiAgICB9KS5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coJ0dvdCBlcnJvciA6JywgZXJyb3IpO1xuICAgIH0pXG5cbldlYmNhbS5zZXQoe1xuICAgIGhlaWdodDogNDUwLFxuICAgIHdpZHRoOiA4MDAsXG4gICAgaW1hZ2VfZm9ybWF0OiAnanBlZycsXG4gICAganBlZ19xdWFsaXR5OiAxMDBcbn0pO1xuXG5XZWJjYW0uYXR0YWNoKCcjbXlfY2FtZXJhJyk7XG5cbmxldCBhdWRpbyA9IG5ldyBBdWRpbygnLi4vYXNzZXRzL2F1ZGlvL3BvcC5tcDMnKTtcblxuXG5sZXQgaGF0Q291bnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImhhdC1jb3VudFwiKTtcbmxldCBoYXRDb3VudExpc3QgPSBbXG4gICAgMSwgNSwgMTAsIDE1LCAyMFxuXTtcbmxldCBoYXRDb3VudEluZGV4ID0gMDtcblxubGV0IGhhdENvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiaGF0LXR5cGVcIik7XG5sZXQgaGF0SW5kZXggPSAwO1xubGV0IGhhdExpc3Q7XG5sZXQgb3ZlcmxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwib3ZlcmxheVwiKTtcbmxldCBsb2FkaW5nR2lmID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJsb2FkaW5nXCIpO1xubGV0IGNhbWVyYSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibXlfY2FtZXJhXCIpO1xubGV0IGJ1dHRvbkNvbnRyb2xzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJidXR0b24tY29udHJvbHNcIik7XG5cbndpbmRvdy5vbmxvYWQgPSBhc3luYyAoKSA9PiB7XG4gICAgaGF0Q291bnQuaW5uZXJIVE1MID0gaGF0Q291bnRMaXN0W2hhdENvdW50SW5kZXhdO1xuXG4gICAgbGV0IGJhc2VVcmwgPSBcIi9hcGkvbGlzdFwiO1xuXG4gICAgLy8gZ2V0IGRlc2NyaXB0aW9uIGFuZCBpbWFnZSBsaW5rc1xuICAgIGxldCBoYXRzID0gYXdhaXQgZmV0Y2goYmFzZVVybCwge1xuICAgICAgICBtZXRob2Q6IFwiR0VUXCJcbiAgICB9KVxuICAgIGhhdExpc3QgPSBhd2FpdCBoYXRzLmpzb24oKVxuICAgIGNvbnNvbGUubG9nKGhhdExpc3QpXG5cbiAgICBzZXRIYXRzKGhhdExpc3QpO1xufVxuXG5mdW5jdGlvbiBzZXRIYXRzKGhhdExpc3QpIHtcblxuICAgIGhhdENvbnRhaW5lci5zcmMgPSBoYXRMaXN0W2hhdEluZGV4XS51cmw7XG4gICAgaGF0Q29udGFpbmVyLmFsdCA9IGhhdExpc3RbaGF0SW5kZXhdLmRlc2NyaXB0aW9uO1xufVxuXG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImhhdC10eXBlLWNvbnRhaW5lclwiKS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGF1ZGlvLnBsYXkoKTtcbiAgICBoYXRJbmRleCArPSAxO1xuXG4gICAgaWYgKGhhdEluZGV4ID4gaGF0TGlzdC5sZW5ndGggLSAxKSB7XG4gICAgICAgIGhhdEluZGV4ID0gMDtcbiAgICB9XG4gICAgaGF0Q29udGFpbmVyLnNyYyA9IGhhdExpc3RbaGF0SW5kZXhdLnVybDtcbiAgICBoYXRDb250YWluZXIuYWx0ID0gaGF0TGlzdFtoYXRJbmRleF0uZGVzY3JpcHRpb247XG5cbn0pO1xuXG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNvdW50LWNvbnRhaW5lclwiKS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGF1ZGlvLnBsYXkoKTtcbiAgICBoYXRDb3VudEluZGV4ICs9IDE7XG4gICAgaWYgKGhhdENvdW50SW5kZXggPiA0KSB7XG4gICAgICAgIGhhdENvdW50SW5kZXggPSAwO1xuICAgIH1cbiAgICBoYXRDb3VudC5pbm5lckhUTUwgPSBoYXRDb3VudExpc3RbaGF0Q291bnRJbmRleF07XG5cbn0pO1xuXG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNuYXBcIikuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgYXVkaW8ucGxheSgpO1xuICAgIG92ZXJsYXkuY2xhc3NMaXN0LnJlbW92ZShcImhpZGRlblwiKTtcbiAgICBsb2FkaW5nR2lmLmNsYXNzTGlzdC5yZW1vdmUoXCJoaWRkZW5cIik7XG4gICAgcmVtb3ZlQWxsQ2hpbGROb2RlcyhjYW1lcmEpO1xuXG4gICAgbGV0IHNwaW5uZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3Bpbm5lcicpO1xuICAgIGxldCByZXN1bHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdWx0Jyk7XG4gICAgV2ViY2FtLnNuYXAoYXN5bmMgZnVuY3Rpb24gKGRhdGFfdXJpKSB7XG4gICAgICAgIC8vIGRpc3BsYXkgcmVzdWx0cyBpbiBwYWdlICBcblxuICAgICAgICB2YXIgZmlsZSA9IGRhdGFVUkx0b0ZpbGUoZGF0YV91cmksICdicnVoLmpwZWcnKTtcbiAgICAgICAgY29uc29sZS5sb2coZmlsZSk7XG4gICAgICAgIC8vIFNhdmVCbG9iQXMoZmlsZSwgXCJ0ZXN0LmpwZWdcIik7XG5cbiAgICAgICAgdmFyIGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgICAgIGxldCBiYXNlVXJsID0gXCIvYXBpL2hhdFwiO1xuICAgICAgICBsZXQgdHlwZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiaGF0LXR5cGVcIikuYWx0XG5cbiAgICAgICAgYmFzZVVybCArPSBgP251bWJlcj0ke2hhdENvdW50LmlubmVySFRNTH1gXG5cblxuICAgICAgICBsZXQgbWV0aG9kO1xuICAgICAgICBsZXQgb3B0aW9ucyA9IHt9XG5cbiAgICAgICAgbWV0aG9kID0gXCJQT1NUXCJcblxuICAgICAgICBmb3JtRGF0YS5hcHBlbmQoXCJmaWxlXCIsIGZpbGUpO1xuICAgICAgICBvcHRpb25zID0ge1xuICAgICAgICAgICAgbWV0aG9kLFxuICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgIHR5cGVcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBib2R5OiBmb3JtRGF0YVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc29sZS5sb2coXCJNYWtpbmcgZmV0Y2hcIilcbiAgICAgICAgY29uc29sZS5sb2coYmFzZVVybClcbiAgICAgICAgY29uc29sZS5sb2cob3B0aW9ucylcblxuICAgICAgICBsZXQgcmVzcCA9IGF3YWl0IGZldGNoKGJhc2VVcmwsIG9wdGlvbnMpO1xuICAgICAgICBsZXQgZGF0YSA9IGF3YWl0IHJlc3AuanNvbigpO1xuICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcblxuICAgICAgICBsZXQgaW1nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImltZ1wiKTtcbiAgICAgICAgaW1nLnNyYyA9IGRhdGEucmVzdWx0LmZpbmFsQmFieTtcbiAgICAgICAgY2FtZXJhLmFwcGVuZENoaWxkKGltZyk7XG4gICAgICAgIC8vIHJlc3VsdC5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZGVuXCIpO1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJlc3VsdFwiKSk7XG4gICAgICAgIGxvYWRpbmdHaWYuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7XG4gICAgICAgIG92ZXJsYXkuY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTtcbiAgICAgICAgYnV0dG9uQ29udHJvbHMuY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTtcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZXNldFwiKS5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZGVuXCIpO1xuICAgIH0pO1xuXG5cbn0pO1xuXG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJlc2V0XCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgcmVtb3ZlQWxsQ2hpbGROb2RlcyhjYW1lcmEpO1xuICAgIFdlYmNhbS5hdHRhY2goJyNteV9jYW1lcmEnKTtcbiAgICBidXR0b25Db250cm9scy5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZGVuXCIpO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmVzZXRcIikuY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTtcbn0pXG5cbmZ1bmN0aW9uIFNhdmVCbG9iQXMoYmxvYiwgZmlsZV9uYW1lKSB7XG4gICAgaWYgKHR5cGVvZiBuYXZpZ2F0b3IubXNTYXZlQmxvYiA9PSBcImZ1bmN0aW9uXCIpXG4gICAgICAgIHJldHVybiBuYXZpZ2F0b3IubXNTYXZlQmxvYihibG9iLCBmaWxlX25hbWUpO1xuXG4gICAgdmFyIHNhdmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKFwiaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbFwiLCBcImFcIik7XG4gICAgdmFyIGJsb2JVUkwgPSBzYXZlci5ocmVmID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKSxcbiAgICAgICAgYm9keSA9IGRvY3VtZW50LmJvZHk7XG5cbiAgICBzYXZlci5kb3dubG9hZCA9IGZpbGVfbmFtZTtcblxuICAgIGJvZHkuYXBwZW5kQ2hpbGQoc2F2ZXIpO1xuICAgIHNhdmVyLmRpc3BhdGNoRXZlbnQobmV3IE1vdXNlRXZlbnQoXCJjbGlja1wiKSk7XG4gICAgYm9keS5yZW1vdmVDaGlsZChzYXZlcik7XG4gICAgVVJMLnJldm9rZU9iamVjdFVSTChibG9iVVJMKTtcbn1cblxuZnVuY3Rpb24gZGF0YVVSTHRvRmlsZShkYXRhdXJsLCBmaWxlbmFtZSkge1xuXG4gICAgdmFyIGFyciA9IGRhdGF1cmwuc3BsaXQoJywnKSxcbiAgICAgICAgbWltZSA9IGFyclswXS5tYXRjaCgvOiguKj8pOy8pWzFdLFxuXG4gICAgICAgIGJzdHIgPSBhdG9iKGFyclsxXSksXG4gICAgICAgIG4gPSBic3RyLmxlbmd0aCxcbiAgICAgICAgdThhcnIgPSBuZXcgVWludDhBcnJheShuKTtcbiAgICBjb25zb2xlLmxvZyhtaW1lKVxuXG4gICAgd2hpbGUgKG4tLSkge1xuICAgICAgICB1OGFycltuXSA9IGJzdHIuY2hhckNvZGVBdChuKTtcbiAgICB9XG5cbiAgICByZXR1cm4gbmV3IEZpbGUoW3U4YXJyXSwgZmlsZW5hbWUsIHsgdHlwZTogbWltZSB9KTtcbn1cblxuXG5cblxuXG5cbi8vIGNsaWNrIGV2ZW50IGxpc3RlbmVyXG4kKCdib2R5Jykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICBleHBsb2RlKGUucGFnZVgsIGUucGFnZVkpO1xufSlcblxuLy8gZXhwbG9zaW9uIGNvbnN0cnVjdGlvblxuZnVuY3Rpb24gZXhwbG9kZSh4LCB5KSB7XG4gICAgdmFyIHBhcnRpY2xlcyA9IDE1LFxuICAgICAgICAvLyBleHBsb3Npb24gY29udGFpbmVyIGFuZCBpdHMgcmVmZXJlbmNlIHRvIGJlIGFibGUgdG8gZGVsZXRlIGl0IG9uIGFuaW1hdGlvbiBlbmRcbiAgICAgICAgZXhwbG9zaW9uID0gJCgnPGRpdiBjbGFzcz1cImV4cGxvc2lvblwiPjwvZGl2PicpO1xuXG4gICAgLy8gcHV0IHRoZSBleHBsb3Npb24gY29udGFpbmVyIGludG8gdGhlIGJvZHkgdG8gYmUgYWJsZSB0byBnZXQgaXQncyBzaXplXG4gICAgJCgnYm9keScpLmFwcGVuZChleHBsb3Npb24pO1xuXG4gICAgLy8gcG9zaXRpb24gdGhlIGNvbnRhaW5lciB0byBiZSBjZW50ZXJlZCBvbiBjbGlja1xuICAgIGV4cGxvc2lvbi5jc3MoJ2xlZnQnLCB4IC0gZXhwbG9zaW9uLndpZHRoKCkgLyAyKTtcbiAgICBleHBsb3Npb24uY3NzKCd0b3AnLCB5IC0gZXhwbG9zaW9uLmhlaWdodCgpIC8gMik7XG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBhcnRpY2xlczsgaSsrKSB7XG4gICAgICAgIC8vIHBvc2l0aW9uaW5nIHgseSBvZiB0aGUgcGFydGljbGUgb24gdGhlIGNpcmNsZSAobGl0dGxlIHJhbmRvbWl6ZWQgcmFkaXVzKVxuICAgICAgICB2YXIgeCA9IChleHBsb3Npb24ud2lkdGgoKSAvIDIpICsgcmFuZCg4MCwgMTUwKSAqIE1hdGguY29zKDIgKiBNYXRoLlBJICogaSAvIHJhbmQocGFydGljbGVzIC0gMTAsIHBhcnRpY2xlcyArIDEwKSksXG4gICAgICAgICAgICB5ID0gKGV4cGxvc2lvbi5oZWlnaHQoKSAvIDIpICsgcmFuZCg4MCwgMTUwKSAqIE1hdGguc2luKDIgKiBNYXRoLlBJICogaSAvIHJhbmQocGFydGljbGVzIC0gMTAsIHBhcnRpY2xlcyArIDEwKSksXG4gICAgICAgICAgICBjb2xvciA9IHJhbmQoMCwgMjU1KSArICcsICcgKyByYW5kKDAsIDI1NSkgKyAnLCAnICsgcmFuZCgwLCAyNTUpLCAvLyByYW5kb21pemUgdGhlIGNvbG9yIHJnYlxuICAgICAgICAgICAgLy8gcGFydGljbGUgZWxlbWVudCBjcmVhdGlvbiAoY291bGQgYmUgYW55dGhpbmcgb3RoZXIgdGhhbiBkaXYpXG4gICAgICAgICAgICBlbG0gPSAkKCc8ZGl2IGNsYXNzPVwicGFydGljbGVcIiBzdHlsZT1cIicgK1xuICAgICAgICAgICAgICAgICdiYWNrZ3JvdW5kLWNvbG9yOiByZ2IoJyArIGNvbG9yICsgJykgOycgK1xuICAgICAgICAgICAgICAgICd0b3A6ICcgKyB5ICsgJ3B4OyAnICtcbiAgICAgICAgICAgICAgICAnbGVmdDogJyArIHggKyAncHhcIj48L2Rpdj4nKTtcblxuICAgICAgICBpZiAoaSA9PSAwKSB7IC8vIG5vIG5lZWQgdG8gYWRkIHRoZSBsaXN0ZW5lciBvbiBhbGwgZ2VuZXJhdGVkIGVsZW1lbnRzXG4gICAgICAgICAgICAvLyBjc3MzIGFuaW1hdGlvbiBlbmQgZGV0ZWN0aW9uXG4gICAgICAgICAgICBlbG0ub25lKCd3ZWJraXRBbmltYXRpb25FbmQgb2FuaW1hdGlvbmVuZCBtc0FuaW1hdGlvbkVuZCBhbmltYXRpb25lbmQnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGV4cGxvc2lvbi5yZW1vdmUoKTsgLy8gcmVtb3ZlIHRoaXMgZXhwbG9zaW9uIGNvbnRhaW5lciB3aGVuIGFuaW1hdGlvbiBlbmRlZFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZXhwbG9zaW9uLmFwcGVuZChlbG0pO1xuICAgIH1cbn1cblxuLy8gZ2V0IHJhbmRvbSBudW1iZXIgYmV0d2VlbiBtaW4gYW5kIG1heCB2YWx1ZVxuZnVuY3Rpb24gcmFuZChtaW4sIG1heCkge1xuICAgIHJldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAobWF4ICsgMSkpICsgbWluO1xufVxuXG5mdW5jdGlvbiByZW1vdmVBbGxDaGlsZE5vZGVzKHBhcmVudCkge1xuICAgIHdoaWxlIChwYXJlbnQuZmlyc3RDaGlsZCkge1xuICAgICAgICBwYXJlbnQucmVtb3ZlQ2hpbGQocGFyZW50LmZpcnN0Q2hpbGQpO1xuICAgIH1cbn0iXX0=