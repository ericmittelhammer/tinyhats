"use strict";

/* eslint-disable */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory(require('animejs')) : typeof define === 'function' && define.amd ? define(['animejs'], factory) : global.Particles = factory(global.anime);
})(void 0, function (anime) {
  'use strict';
  /* eslint-enable */

  function Particles(element, options) {
    this.el = getElement(element);
    this.options = extend({
      color: getCSSValue(this.el, 'background-color')
    }, this.defaults, options);
    this.init();
  }

  Particles.prototype = {
    defaults: {
      type: 'circle',
      style: 'fill',
      canvasPadding: 150,
      duration: 1000,
      easing: 'easeInOutCubic',
      direction: 'left',
      size: function () {
        return Math.floor(Math.random() * 3 + 1);
      },
      speed: function () {
        return rand(4);
      },
      particlesAmountCoefficient: 3,
      oscillationCoefficient: 20
    },
    init: function () {
      this.particles = [];
      this.frame = null;
      this.canvas = document.createElement('canvas');
      this.ctx = this.canvas.getContext('2d');
      this.canvas.className = 'particles-canvas';
      this.canvas.style = 'display:none;';
      this.wrapper = document.createElement('div');
      this.wrapper.className = 'particles-wrapper';
      this.el.parentNode.insertBefore(this.wrapper, this.el);
      this.wrapper.appendChild(this.el);
      this.parentWrapper = document.createElement('div');
      this.parentWrapper.className = 'particles';
      this.wrapper.parentNode.insertBefore(this.parentWrapper, this.wrapper);
      this.parentWrapper.appendChild(this.wrapper);
      this.parentWrapper.appendChild(this.canvas);
    },
    loop: function () {
      this.updateParticles();
      this.renderParticles();

      if (this.isAnimating()) {
        this.frame = requestAnimationFrame(this.loop.bind(this));
      }
    },
    updateParticles: function () {
      var p;

      for (var i = 0; i < this.particles.length; i++) {
        p = this.particles[i];

        if (p.life > p.death) {
          this.particles.splice(i, 1);
        } else {
          p.x += p.speed;
          p.y = this.o.oscillationCoefficient * Math.sin(p.counter * p.increase);
          p.life++;
          p.counter += this.disintegrating ? 1 : -1;
        }
      }

      if (!this.particles.length) {
        this.pause();
        this.canvas.style.display = 'none';

        if (is.fnc(this.o.complete)) {
          this.o.complete();
        }
      }
    },
    renderParticles: function () {
      this.ctx.clearRect(0, 0, this.width, this.height);
      var p;

      for (var i = 0; i < this.particles.length; i++) {
        p = this.particles[i];

        if (p.life < p.death) {
          this.ctx.translate(p.startX, p.startY);
          this.ctx.rotate(p.angle * Math.PI / 180);
          this.ctx.globalAlpha = this.disintegrating ? 1 - p.life / p.death : p.life / p.death;
          this.ctx.fillStyle = this.ctx.strokeStyle = p.color;
          this.ctx.beginPath();

          if (this.o.type === 'circle') {
            this.ctx.arc(p.x, p.y, p.size, 0, 2 * Math.PI);
          } else if (this.o.type === 'triangle') {
            this.ctx.moveTo(p.x, p.y);
            this.ctx.lineTo(p.x + p.size, p.y + p.size);
            this.ctx.lineTo(p.x + p.size, p.y - p.size);
          } else if (this.o.type === 'rectangle') {
            this.ctx.rect(p.x, p.y, p.size, p.size);
          }

          if (this.o.style === 'fill') {
            this.ctx.fill();
          } else if (this.o.style === 'stroke') {
            this.ctx.closePath();
            this.ctx.stroke();
          }

          this.ctx.globalAlpha = 1;
          this.ctx.rotate(-p.angle * Math.PI / 180);
          this.ctx.translate(-p.startX, -p.startY);
        }
      }
    },
    play: function () {
      this.frame = requestAnimationFrame(this.loop.bind(this));
    },
    pause: function () {
      cancelAnimationFrame(this.frame);
      this.frame = null;
    },
    addParticle: function (options) {
      var frames = this.o.duration * 60 / 1000;
      var speed = is.fnc(this.o.speed) ? this.o.speed() : this.o.speed;
      var color = is.fnc(this.o.color) ? this.o.color() : this.o.color;
      this.particles.push({
        startX: options.x,
        startY: options.y,
        x: this.disintegrating ? 0 : speed * -frames,
        y: 0,
        color: color,
        angle: rand(360),
        counter: this.disintegrating ? 0 : frames,
        increase: Math.PI * 2 / 100,
        life: 0,
        death: this.disintegrating ? frames - 20 + Math.random() * 40 : frames,
        speed: speed,
        size: is.fnc(this.o.size) ? this.o.size() : this.o.size
      });
    },
    addParticles: function (rect, progress) {
      var progressDiff = this.disintegrating ? progress - this.lastProgress : this.lastProgress - progress;
      this.lastProgress = progress;
      var x = this.options.canvasPadding;
      var y = this.options.canvasPadding;
      var progressValue = (this.isHorizontal() ? rect.width : rect.height) * progress + progressDiff * (this.disintegrating ? 100 : 220);

      if (this.isHorizontal()) {
        x += this.o.direction === 'left' ? progressValue : rect.width - progressValue;
      } else {
        y += this.o.direction === 'top' ? progressValue : rect.height - progressValue;
      }

      var i = Math.floor(this.o.particlesAmountCoefficient * (progressDiff * 100 + 1));

      if (i > 0) {
        while (i--) {
          this.addParticle({
            x: x + (this.isHorizontal() ? 0 : rect.width * Math.random()),
            y: y + (this.isHorizontal() ? rect.height * Math.random() : 0)
          });
        }
      }

      if (!this.isAnimating()) {
        this.canvas.style.display = 'block';
        this.play();
      }
    },
    addTransforms: function (value) {
      var translateProperty = this.isHorizontal() ? 'translateX' : 'translateY';
      var translateValue = this.o.direction === 'left' || this.o.direction === 'top' ? value : -value;
      this.wrapper.style[transformString] = translateProperty + '(' + translateValue + '%)';
      this.el.style[transformString] = translateProperty + '(' + -translateValue + '%)';
    },
    disintegrate: function (options) {
      if (!this.isAnimating()) {
        this.disintegrating = true;
        this.lastProgress = 0;
        this.setup(options);

        var _ = this;

        this.animate(function (anim) {
          var value = anim.animatables[0].target.value;

          _.addTransforms(value);

          if (_.o.duration) {
            _.addParticles(_.rect, value / 100, true);
          }
        });
      }
    },
    integrate: function (options) {
      if (!this.isAnimating()) {
        this.disintegrating = false;
        this.lastProgress = 1;
        this.setup(options);

        var _ = this;

        this.animate(function (anim) {
          var value = anim.animatables[0].target.value;
          setTimeout(function () {
            _.addTransforms(value);
          }, _.o.duration);

          if (_.o.duration) {
            _.addParticles(_.rect, value / 100, true);
          }
        });
      }
    },
    setup: function (options) {
      this.o = extend({}, this.options, options);
      this.wrapper.style.visibility = 'visible';

      if (this.o.duration) {
        this.rect = this.el.getBoundingClientRect();
        this.width = this.canvas.width = this.o.width || this.rect.width + this.o.canvasPadding * 2;
        this.height = this.canvas.height = this.o.height || this.rect.height + this.o.canvasPadding * 2;
      }
    },
    animate: function (update) {
      var _ = this;

      anime({
        targets: {
          value: _.disintegrating ? 0 : 101
        },
        value: _.disintegrating ? 101 : 0,
        duration: _.o.duration,
        easing: _.o.easing,
        begin: _.o.begin,
        update: update,
        complete: function () {
          if (_.disintegrating) {
            _.wrapper.style.visibility = 'hidden';
          }
        }
      });
    },
    isAnimating: function () {
      return !!this.frame;
    },
    isHorizontal: function () {
      return this.o.direction === 'left' || this.o.direction === 'right';
    }
  }; // Utils

  var is = {
    arr: function (a) {
      return Array.isArray(a);
    },
    str: function (a) {
      return typeof a === 'string';
    },
    fnc: function (a) {
      return typeof a === 'function';
    }
  };

  function stringToHyphens(str) {
    return str.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase();
  }

  function getCSSValue(el, prop) {
    if (prop in el.style) {
      return getComputedStyle(el).getPropertyValue(stringToHyphens(prop)) || '0';
    }
  }

  var t = 'transform';
  var transformString = getCSSValue(document.body, t) ? t : '-webkit-' + t;

  function extendSingle(target, source) {
    for (var key in source) target[key] = is.arr(source[key]) ? source[key].slice(0) : source[key];

    return target;
  }

  function extend(target) {
    if (!target) target = {};

    for (var i = 1; i < arguments.length; i++) extendSingle(target, arguments[i]);

    return target;
  }

  function rand(value) {
    return Math.random() * value - value / 2;
  }

  function getElement(element) {
    return is.str(element) ? document.querySelector(element) : element;
  }

  return Particles;
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2Fzc2V0cy9qcy9wYXJ0aWNsZXMuanMiXSwibmFtZXMiOlsiZ2xvYmFsIiwiZmFjdG9yeSIsImV4cG9ydHMiLCJtb2R1bGUiLCJyZXF1aXJlIiwiZGVmaW5lIiwiYW1kIiwiUGFydGljbGVzIiwiYW5pbWUiLCJlbGVtZW50Iiwib3B0aW9ucyIsImVsIiwiZ2V0RWxlbWVudCIsImV4dGVuZCIsImNvbG9yIiwiZ2V0Q1NTVmFsdWUiLCJkZWZhdWx0cyIsImluaXQiLCJwcm90b3R5cGUiLCJ0eXBlIiwic3R5bGUiLCJjYW52YXNQYWRkaW5nIiwiZHVyYXRpb24iLCJlYXNpbmciLCJkaXJlY3Rpb24iLCJzaXplIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwic3BlZWQiLCJyYW5kIiwicGFydGljbGVzQW1vdW50Q29lZmZpY2llbnQiLCJvc2NpbGxhdGlvbkNvZWZmaWNpZW50IiwicGFydGljbGVzIiwiZnJhbWUiLCJjYW52YXMiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJjdHgiLCJnZXRDb250ZXh0IiwiY2xhc3NOYW1lIiwid3JhcHBlciIsInBhcmVudE5vZGUiLCJpbnNlcnRCZWZvcmUiLCJhcHBlbmRDaGlsZCIsInBhcmVudFdyYXBwZXIiLCJsb29wIiwidXBkYXRlUGFydGljbGVzIiwicmVuZGVyUGFydGljbGVzIiwiaXNBbmltYXRpbmciLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJiaW5kIiwicCIsImkiLCJsZW5ndGgiLCJsaWZlIiwiZGVhdGgiLCJzcGxpY2UiLCJ4IiwieSIsIm8iLCJzaW4iLCJjb3VudGVyIiwiaW5jcmVhc2UiLCJkaXNpbnRlZ3JhdGluZyIsInBhdXNlIiwiZGlzcGxheSIsImlzIiwiZm5jIiwiY29tcGxldGUiLCJjbGVhclJlY3QiLCJ3aWR0aCIsImhlaWdodCIsInRyYW5zbGF0ZSIsInN0YXJ0WCIsInN0YXJ0WSIsInJvdGF0ZSIsImFuZ2xlIiwiUEkiLCJnbG9iYWxBbHBoYSIsImZpbGxTdHlsZSIsInN0cm9rZVN0eWxlIiwiYmVnaW5QYXRoIiwiYXJjIiwibW92ZVRvIiwibGluZVRvIiwicmVjdCIsImZpbGwiLCJjbG9zZVBhdGgiLCJzdHJva2UiLCJwbGF5IiwiY2FuY2VsQW5pbWF0aW9uRnJhbWUiLCJhZGRQYXJ0aWNsZSIsImZyYW1lcyIsInB1c2giLCJhZGRQYXJ0aWNsZXMiLCJwcm9ncmVzcyIsInByb2dyZXNzRGlmZiIsImxhc3RQcm9ncmVzcyIsInByb2dyZXNzVmFsdWUiLCJpc0hvcml6b250YWwiLCJhZGRUcmFuc2Zvcm1zIiwidmFsdWUiLCJ0cmFuc2xhdGVQcm9wZXJ0eSIsInRyYW5zbGF0ZVZhbHVlIiwidHJhbnNmb3JtU3RyaW5nIiwiZGlzaW50ZWdyYXRlIiwic2V0dXAiLCJfIiwiYW5pbWF0ZSIsImFuaW0iLCJhbmltYXRhYmxlcyIsInRhcmdldCIsImludGVncmF0ZSIsInNldFRpbWVvdXQiLCJ2aXNpYmlsaXR5IiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0IiwidXBkYXRlIiwidGFyZ2V0cyIsImJlZ2luIiwiYXJyIiwiYSIsIkFycmF5IiwiaXNBcnJheSIsInN0ciIsInN0cmluZ1RvSHlwaGVucyIsInJlcGxhY2UiLCJ0b0xvd2VyQ2FzZSIsInByb3AiLCJnZXRDb21wdXRlZFN0eWxlIiwiZ2V0UHJvcGVydHlWYWx1ZSIsInQiLCJib2R5IiwiZXh0ZW5kU2luZ2xlIiwic291cmNlIiwia2V5Iiwic2xpY2UiLCJhcmd1bWVudHMiLCJxdWVyeVNlbGVjdG9yIl0sIm1hcHBpbmdzIjoiOztBQUFBO0FBQ0MsV0FBVUEsTUFBVixFQUFrQkMsT0FBbEIsRUFBMkI7QUFDeEIsU0FBT0MsT0FBUCxLQUFtQixRQUFuQixJQUErQixPQUFPQyxNQUFQLEtBQWtCLFdBQWpELEdBQStEQSxNQUFNLENBQUNELE9BQVAsR0FBaUJELE9BQU8sQ0FBQ0csT0FBTyxDQUFDLFNBQUQsQ0FBUixDQUF2RixHQUNJLE9BQU9DLE1BQVAsS0FBa0IsVUFBbEIsSUFBZ0NBLE1BQU0sQ0FBQ0MsR0FBdkMsR0FB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ekIsV0FBTzBELEVBQUUsQ0FBQ3lELEdBQUgsQ0FBT25ILE9BQVAsSUFBa0IyQixRQUFRLENBQUNzRyxhQUFULENBQXVCakksT0FBdkIsQ0FBbEIsR0FBb0RBLE9BQTNEO0FBQ0g7O0FBRUQsU0FBT0YsU0FBUDtBQUVILENBclJBLENBQUQiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSAqL1xuKGZ1bmN0aW9uIChnbG9iYWwsIGZhY3RvcnkpIHtcbiAgICB0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcgPyBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkocmVxdWlyZSgnYW5pbWVqcycpKSA6XG4gICAgICAgIHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCA/IGRlZmluZShbJ2FuaW1lanMnXSwgZmFjdG9yeSkgOlxuICAgICAgICAgICAgKGdsb2JhbC5QYXJ0aWNsZXMgPSBmYWN0b3J5KGdsb2JhbC5hbmltZSkpO1xufSh0aGlzLCAoZnVuY3Rpb24gKGFuaW1lKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIC8qIGVzbGludC1lbmFibGUgKi9cblxuICAgIGZ1bmN0aW9uIFBhcnRpY2xlcyhlbGVtZW50LCBvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuZWwgPSBnZXRFbGVtZW50KGVsZW1lbnQpO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBleHRlbmQoeyBjb2xvcjogZ2V0Q1NTVmFsdWUodGhpcy5lbCwgJ2JhY2tncm91bmQtY29sb3InKSB9LCB0aGlzLmRlZmF1bHRzLCBvcHRpb25zKTtcbiAgICAgICAgdGhpcy5pbml0KCk7XG4gICAgfVxuXG4gICAgUGFydGljbGVzLnByb3RvdHlwZSA9IHtcbiAgICAgICAgZGVmYXVsdHM6IHtcbiAgICAgICAgICAgIHR5cGU6ICdjaXJjbGUnLFxuICAgICAgICAgICAgc3R5bGU6ICdmaWxsJyxcbiAgICAgICAgICAgIGNhbnZhc1BhZGRpbmc6IDE1MCxcbiAgICAgICAgICAgIGR1cmF0aW9uOiAxMDAwLFxuICAgICAgICAgICAgZWFzaW5nOiAnZWFzZUluT3V0Q3ViaWMnLFxuICAgICAgICAgICAgZGlyZWN0aW9uOiAnbGVmdCcsXG4gICAgICAgICAgICBzaXplOiBmdW5jdGlvbiAoKSB7IHJldHVybiBNYXRoLmZsb29yKChNYXRoLnJhbmRvbSgpICogMykgKyAxKTsgfSxcbiAgICAgICAgICAgIHNwZWVkOiBmdW5jdGlvbiAoKSB7IHJldHVybiByYW5kKDQpOyB9LFxuICAgICAgICAgICAgcGFydGljbGVzQW1vdW50Q29lZmZpY2llbnQ6IDMsXG4gICAgICAgICAgICBvc2NpbGxhdGlvbkNvZWZmaWNpZW50OiAyMFxuICAgICAgICB9LFxuICAgICAgICBpbml0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLnBhcnRpY2xlcyA9IFtdO1xuICAgICAgICAgICAgdGhpcy5mcmFtZSA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLmNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xuICAgICAgICAgICAgdGhpcy5jdHggPSB0aGlzLmNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuICAgICAgICAgICAgdGhpcy5jYW52YXMuY2xhc3NOYW1lID0gJ3BhcnRpY2xlcy1jYW52YXMnO1xuICAgICAgICAgICAgdGhpcy5jYW52YXMuc3R5bGUgPSAnZGlzcGxheTpub25lOyc7XG4gICAgICAgICAgICB0aGlzLndyYXBwZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgICAgIHRoaXMud3JhcHBlci5jbGFzc05hbWUgPSAncGFydGljbGVzLXdyYXBwZXInO1xuICAgICAgICAgICAgdGhpcy5lbC5wYXJlbnROb2RlLmluc2VydEJlZm9yZSh0aGlzLndyYXBwZXIsIHRoaXMuZWwpO1xuICAgICAgICAgICAgdGhpcy53cmFwcGVyLmFwcGVuZENoaWxkKHRoaXMuZWwpO1xuICAgICAgICAgICAgdGhpcy5wYXJlbnRXcmFwcGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICB0aGlzLnBhcmVudFdyYXBwZXIuY2xhc3NOYW1lID0gJ3BhcnRpY2xlcyc7XG4gICAgICAgICAgICB0aGlzLndyYXBwZXIucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUodGhpcy5wYXJlbnRXcmFwcGVyLCB0aGlzLndyYXBwZXIpO1xuICAgICAgICAgICAgdGhpcy5wYXJlbnRXcmFwcGVyLmFwcGVuZENoaWxkKHRoaXMud3JhcHBlcik7XG4gICAgICAgICAgICB0aGlzLnBhcmVudFdyYXBwZXIuYXBwZW5kQ2hpbGQodGhpcy5jYW52YXMpO1xuICAgICAgICB9LFxuICAgICAgICBsb29wOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVBhcnRpY2xlcygpO1xuICAgICAgICAgICAgdGhpcy5yZW5kZXJQYXJ0aWNsZXMoKTtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzQW5pbWF0aW5nKCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZyYW1lID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRoaXMubG9vcC5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgdXBkYXRlUGFydGljbGVzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgcDtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5wYXJ0aWNsZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBwID0gdGhpcy5wYXJ0aWNsZXNbaV07XG4gICAgICAgICAgICAgICAgaWYgKHAubGlmZSA+IHAuZGVhdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXJ0aWNsZXMuc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHAueCArPSBwLnNwZWVkO1xuICAgICAgICAgICAgICAgICAgICBwLnkgPSB0aGlzLm8ub3NjaWxsYXRpb25Db2VmZmljaWVudCAqIE1hdGguc2luKHAuY291bnRlciAqIHAuaW5jcmVhc2UpO1xuICAgICAgICAgICAgICAgICAgICBwLmxpZmUrKztcbiAgICAgICAgICAgICAgICAgICAgcC5jb3VudGVyICs9IHRoaXMuZGlzaW50ZWdyYXRpbmcgPyAxIDogLTE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCF0aGlzLnBhcnRpY2xlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBhdXNlKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5jYW52YXMuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgICAgICAgICAgICBpZiAoaXMuZm5jKHRoaXMuby5jb21wbGV0ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vLmNvbXBsZXRlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICByZW5kZXJQYXJ0aWNsZXM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoaXMuY3R4LmNsZWFyUmVjdCgwLCAwLCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodCk7XG4gICAgICAgICAgICB2YXIgcDtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5wYXJ0aWNsZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBwID0gdGhpcy5wYXJ0aWNsZXNbaV07XG4gICAgICAgICAgICAgICAgaWYgKHAubGlmZSA8IHAuZGVhdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jdHgudHJhbnNsYXRlKHAuc3RhcnRYLCBwLnN0YXJ0WSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY3R4LnJvdGF0ZShwLmFuZ2xlICogTWF0aC5QSSAvIDE4MCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY3R4Lmdsb2JhbEFscGhhID0gdGhpcy5kaXNpbnRlZ3JhdGluZyA/IDEgLSBwLmxpZmUgLyBwLmRlYXRoIDogcC5saWZlIC8gcC5kZWF0aDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jdHguZmlsbFN0eWxlID0gdGhpcy5jdHguc3Ryb2tlU3R5bGUgPSBwLmNvbG9yO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmN0eC5iZWdpblBhdGgoKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5vLnR5cGUgPT09ICdjaXJjbGUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmN0eC5hcmMocC54LCBwLnksIHAuc2l6ZSwgMCwgMiAqIE1hdGguUEkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuby50eXBlID09PSAndHJpYW5nbGUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmN0eC5tb3ZlVG8ocC54LCBwLnkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jdHgubGluZVRvKHAueCArIHAuc2l6ZSwgcC55ICsgcC5zaXplKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3R4LmxpbmVUbyhwLnggKyBwLnNpemUsIHAueSAtIHAuc2l6ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5vLnR5cGUgPT09ICdyZWN0YW5nbGUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmN0eC5yZWN0KHAueCwgcC55LCBwLnNpemUsIHAuc2l6ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5vLnN0eWxlID09PSAnZmlsbCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3R4LmZpbGwoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0aGlzLm8uc3R5bGUgPT09ICdzdHJva2UnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmN0eC5jbG9zZVBhdGgoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3R4LnN0cm9rZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jdHguZ2xvYmFsQWxwaGEgPSAxO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmN0eC5yb3RhdGUoLXAuYW5nbGUgKiBNYXRoLlBJIC8gMTgwKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jdHgudHJhbnNsYXRlKC1wLnN0YXJ0WCwgLXAuc3RhcnRZKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHBsYXk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoaXMuZnJhbWUgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGhpcy5sb29wLmJpbmQodGhpcykpO1xuICAgICAgICB9LFxuICAgICAgICBwYXVzZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY2FuY2VsQW5pbWF0aW9uRnJhbWUodGhpcy5mcmFtZSk7XG4gICAgICAgICAgICB0aGlzLmZyYW1lID0gbnVsbDtcbiAgICAgICAgfSxcbiAgICAgICAgYWRkUGFydGljbGU6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgICAgICB2YXIgZnJhbWVzID0gdGhpcy5vLmR1cmF0aW9uICogNjAgLyAxMDAwO1xuICAgICAgICAgICAgdmFyIHNwZWVkID0gaXMuZm5jKHRoaXMuby5zcGVlZCkgPyB0aGlzLm8uc3BlZWQoKSA6IHRoaXMuby5zcGVlZDtcbiAgICAgICAgICAgIHZhciBjb2xvciA9IGlzLmZuYyh0aGlzLm8uY29sb3IpID8gdGhpcy5vLmNvbG9yKCkgOiB0aGlzLm8uY29sb3I7XG4gICAgICAgICAgICB0aGlzLnBhcnRpY2xlcy5wdXNoKHtcbiAgICAgICAgICAgICAgICBzdGFydFg6IG9wdGlvbnMueCxcbiAgICAgICAgICAgICAgICBzdGFydFk6IG9wdGlvbnMueSxcbiAgICAgICAgICAgICAgICB4OiB0aGlzLmRpc2ludGVncmF0aW5nID8gMCA6IHNwZWVkICogLWZyYW1lcyxcbiAgICAgICAgICAgICAgICB5OiAwLFxuICAgICAgICAgICAgICAgIGNvbG9yOiBjb2xvcixcbiAgICAgICAgICAgICAgICBhbmdsZTogcmFuZCgzNjApLFxuICAgICAgICAgICAgICAgIGNvdW50ZXI6IHRoaXMuZGlzaW50ZWdyYXRpbmcgPyAwIDogZnJhbWVzLFxuICAgICAgICAgICAgICAgIGluY3JlYXNlOiBNYXRoLlBJICogMiAvIDEwMCxcbiAgICAgICAgICAgICAgICBsaWZlOiAwLFxuICAgICAgICAgICAgICAgIGRlYXRoOiB0aGlzLmRpc2ludGVncmF0aW5nID8gKGZyYW1lcyAtIDIwKSArIE1hdGgucmFuZG9tKCkgKiA0MCA6IGZyYW1lcyxcbiAgICAgICAgICAgICAgICBzcGVlZDogc3BlZWQsXG4gICAgICAgICAgICAgICAgc2l6ZTogaXMuZm5jKHRoaXMuby5zaXplKSA/IHRoaXMuby5zaXplKCkgOiB0aGlzLm8uc2l6ZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIGFkZFBhcnRpY2xlczogZnVuY3Rpb24gKHJlY3QsIHByb2dyZXNzKSB7XG4gICAgICAgICAgICB2YXIgcHJvZ3Jlc3NEaWZmID0gdGhpcy5kaXNpbnRlZ3JhdGluZyA/IHByb2dyZXNzIC0gdGhpcy5sYXN0UHJvZ3Jlc3MgOiB0aGlzLmxhc3RQcm9ncmVzcyAtIHByb2dyZXNzO1xuICAgICAgICAgICAgdGhpcy5sYXN0UHJvZ3Jlc3MgPSBwcm9ncmVzcztcbiAgICAgICAgICAgIHZhciB4ID0gdGhpcy5vcHRpb25zLmNhbnZhc1BhZGRpbmc7XG4gICAgICAgICAgICB2YXIgeSA9IHRoaXMub3B0aW9ucy5jYW52YXNQYWRkaW5nO1xuICAgICAgICAgICAgdmFyIHByb2dyZXNzVmFsdWUgPSAodGhpcy5pc0hvcml6b250YWwoKSA/IHJlY3Qud2lkdGggOiByZWN0LmhlaWdodCkgKiBwcm9ncmVzcyArIHByb2dyZXNzRGlmZiAqICh0aGlzLmRpc2ludGVncmF0aW5nID8gMTAwIDogMjIwKTtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzSG9yaXpvbnRhbCgpKSB7XG4gICAgICAgICAgICAgICAgeCArPSB0aGlzLm8uZGlyZWN0aW9uID09PSAnbGVmdCcgPyBwcm9ncmVzc1ZhbHVlIDogcmVjdC53aWR0aCAtIHByb2dyZXNzVmFsdWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHkgKz0gdGhpcy5vLmRpcmVjdGlvbiA9PT0gJ3RvcCcgPyBwcm9ncmVzc1ZhbHVlIDogcmVjdC5oZWlnaHQgLSBwcm9ncmVzc1ZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGkgPSBNYXRoLmZsb29yKHRoaXMuby5wYXJ0aWNsZXNBbW91bnRDb2VmZmljaWVudCAqIChwcm9ncmVzc0RpZmYgKiAxMDAgKyAxKSk7XG4gICAgICAgICAgICBpZiAoaSA+IDApIHtcbiAgICAgICAgICAgICAgICB3aGlsZSAoaS0tKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkUGFydGljbGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgeDogeCArICh0aGlzLmlzSG9yaXpvbnRhbCgpID8gMCA6IHJlY3Qud2lkdGggKiBNYXRoLnJhbmRvbSgpKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHk6IHkgKyAodGhpcy5pc0hvcml6b250YWwoKSA/IHJlY3QuaGVpZ2h0ICogTWF0aC5yYW5kb20oKSA6IDApXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghdGhpcy5pc0FuaW1hdGluZygpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jYW52YXMuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG4gICAgICAgICAgICAgICAgdGhpcy5wbGF5KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGFkZFRyYW5zZm9ybXM6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgdmFyIHRyYW5zbGF0ZVByb3BlcnR5ID0gdGhpcy5pc0hvcml6b250YWwoKSA/ICd0cmFuc2xhdGVYJyA6ICd0cmFuc2xhdGVZJztcbiAgICAgICAgICAgIHZhciB0cmFuc2xhdGVWYWx1ZSA9IHRoaXMuby5kaXJlY3Rpb24gPT09ICdsZWZ0JyB8fCB0aGlzLm8uZGlyZWN0aW9uID09PSAndG9wJyA/IHZhbHVlIDogLXZhbHVlO1xuICAgICAgICAgICAgdGhpcy53cmFwcGVyLnN0eWxlW3RyYW5zZm9ybVN0cmluZ10gPSB0cmFuc2xhdGVQcm9wZXJ0eSArICcoJyArIHRyYW5zbGF0ZVZhbHVlICsgJyUpJztcbiAgICAgICAgICAgIHRoaXMuZWwuc3R5bGVbdHJhbnNmb3JtU3RyaW5nXSA9IHRyYW5zbGF0ZVByb3BlcnR5ICsgJygnICsgLXRyYW5zbGF0ZVZhbHVlICsgJyUpJztcbiAgICAgICAgfSxcbiAgICAgICAgZGlzaW50ZWdyYXRlOiBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICAgICAgaWYgKCF0aGlzLmlzQW5pbWF0aW5nKCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRpc2ludGVncmF0aW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLmxhc3RQcm9ncmVzcyA9IDA7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXR1cChvcHRpb25zKTtcbiAgICAgICAgICAgICAgICB2YXIgXyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgdGhpcy5hbmltYXRlKGZ1bmN0aW9uIChhbmltKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IGFuaW0uYW5pbWF0YWJsZXNbMF0udGFyZ2V0LnZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBfLmFkZFRyYW5zZm9ybXModmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoXy5vLmR1cmF0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfLmFkZFBhcnRpY2xlcyhfLnJlY3QsIHZhbHVlIC8gMTAwLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBpbnRlZ3JhdGU6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNBbmltYXRpbmcoKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZGlzaW50ZWdyYXRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLmxhc3RQcm9ncmVzcyA9IDE7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXR1cChvcHRpb25zKTtcbiAgICAgICAgICAgICAgICB2YXIgXyA9IHRoaXM7XG4gICAgICAgICAgICAgICAgdGhpcy5hbmltYXRlKGZ1bmN0aW9uIChhbmltKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IGFuaW0uYW5pbWF0YWJsZXNbMF0udGFyZ2V0LnZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF8uYWRkVHJhbnNmb3Jtcyh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH0sIF8uby5kdXJhdGlvbik7XG4gICAgICAgICAgICAgICAgICAgIGlmIChfLm8uZHVyYXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF8uYWRkUGFydGljbGVzKF8ucmVjdCwgdmFsdWUgLyAxMDAsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHNldHVwOiBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICAgICAgdGhpcy5vID0gZXh0ZW5kKHt9LCB0aGlzLm9wdGlvbnMsIG9wdGlvbnMpO1xuICAgICAgICAgICAgdGhpcy53cmFwcGVyLnN0eWxlLnZpc2liaWxpdHkgPSAndmlzaWJsZSc7XG4gICAgICAgICAgICBpZiAodGhpcy5vLmR1cmF0aW9uKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZWN0ID0gdGhpcy5lbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgICAgICAgICB0aGlzLndpZHRoID0gdGhpcy5jYW52YXMud2lkdGggPSB0aGlzLm8ud2lkdGggfHwgdGhpcy5yZWN0LndpZHRoICsgdGhpcy5vLmNhbnZhc1BhZGRpbmcgKiAyO1xuICAgICAgICAgICAgICAgIHRoaXMuaGVpZ2h0ID0gdGhpcy5jYW52YXMuaGVpZ2h0ID0gdGhpcy5vLmhlaWdodCB8fCB0aGlzLnJlY3QuaGVpZ2h0ICsgdGhpcy5vLmNhbnZhc1BhZGRpbmcgKiAyO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBhbmltYXRlOiBmdW5jdGlvbiAodXBkYXRlKSB7XG4gICAgICAgICAgICB2YXIgXyA9IHRoaXM7XG4gICAgICAgICAgICBhbmltZSh7XG4gICAgICAgICAgICAgICAgdGFyZ2V0czogeyB2YWx1ZTogXy5kaXNpbnRlZ3JhdGluZyA/IDAgOiAxMDEgfSxcbiAgICAgICAgICAgICAgICB2YWx1ZTogXy5kaXNpbnRlZ3JhdGluZyA/IDEwMSA6IDAsXG4gICAgICAgICAgICAgICAgZHVyYXRpb246IF8uby5kdXJhdGlvbixcbiAgICAgICAgICAgICAgICBlYXNpbmc6IF8uby5lYXNpbmcsXG4gICAgICAgICAgICAgICAgYmVnaW46IF8uby5iZWdpbixcbiAgICAgICAgICAgICAgICB1cGRhdGU6IHVwZGF0ZSxcbiAgICAgICAgICAgICAgICBjb21wbGV0ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoXy5kaXNpbnRlZ3JhdGluZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgXy53cmFwcGVyLnN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICBpc0FuaW1hdGluZzogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuICEhdGhpcy5mcmFtZTtcbiAgICAgICAgfSxcbiAgICAgICAgaXNIb3Jpem9udGFsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5vLmRpcmVjdGlvbiA9PT0gJ2xlZnQnIHx8IHRoaXMuby5kaXJlY3Rpb24gPT09ICdyaWdodCc7XG4gICAgICAgIH1cbiAgICB9O1xuXG5cbiAgICAvLyBVdGlsc1xuXG4gICAgdmFyIGlzID0ge1xuICAgICAgICBhcnI6IGZ1bmN0aW9uIChhKSB7IHJldHVybiBBcnJheS5pc0FycmF5KGEpOyB9LFxuICAgICAgICBzdHI6IGZ1bmN0aW9uIChhKSB7IHJldHVybiB0eXBlb2YgYSA9PT0gJ3N0cmluZyc7IH0sXG4gICAgICAgIGZuYzogZnVuY3Rpb24gKGEpIHsgcmV0dXJuIHR5cGVvZiBhID09PSAnZnVuY3Rpb24nOyB9XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIHN0cmluZ1RvSHlwaGVucyhzdHIpIHtcbiAgICAgICAgcmV0dXJuIHN0ci5yZXBsYWNlKC8oW2Etel0pKFtBLVpdKS9nLCAnJDEtJDInKS50b0xvd2VyQ2FzZSgpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldENTU1ZhbHVlKGVsLCBwcm9wKSB7XG4gICAgICAgIGlmIChwcm9wIGluIGVsLnN0eWxlKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0Q29tcHV0ZWRTdHlsZShlbCkuZ2V0UHJvcGVydHlWYWx1ZShzdHJpbmdUb0h5cGhlbnMocHJvcCkpIHx8ICcwJztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHZhciB0ID0gJ3RyYW5zZm9ybSc7XG4gICAgdmFyIHRyYW5zZm9ybVN0cmluZyA9IChnZXRDU1NWYWx1ZShkb2N1bWVudC5ib2R5LCB0KSA/IHQgOiAnLXdlYmtpdC0nICsgdCk7XG5cbiAgICBmdW5jdGlvbiBleHRlbmRTaW5nbGUodGFyZ2V0LCBzb3VyY2UpIHtcbiAgICAgICAgZm9yICh2YXIga2V5IGluIHNvdXJjZSlcbiAgICAgICAgICAgIHRhcmdldFtrZXldID0gaXMuYXJyKHNvdXJjZVtrZXldKSA/IHNvdXJjZVtrZXldLnNsaWNlKDApIDogc291cmNlW2tleV07XG4gICAgICAgIHJldHVybiB0YXJnZXQ7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZXh0ZW5kKHRhcmdldCkge1xuICAgICAgICBpZiAoIXRhcmdldCkgdGFyZ2V0ID0ge307XG4gICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKVxuICAgICAgICAgICAgZXh0ZW5kU2luZ2xlKHRhcmdldCwgYXJndW1lbnRzW2ldKTtcbiAgICAgICAgcmV0dXJuIHRhcmdldDtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiByYW5kKHZhbHVlKSB7XG4gICAgICAgIHJldHVybiBNYXRoLnJhbmRvbSgpICogdmFsdWUgLSB2YWx1ZSAvIDI7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2V0RWxlbWVudChlbGVtZW50KSB7XG4gICAgICAgIHJldHVybiBpcy5zdHIoZWxlbWVudCkgPyBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGVsZW1lbnQpIDogZWxlbWVudDtcbiAgICB9XG5cbiAgICByZXR1cm4gUGFydGljbGVzO1xuXG59KSkpOyJdfQ==